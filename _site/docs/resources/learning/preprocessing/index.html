<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"><style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(14)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(8) > ul > li:nth-child(3) > ul > li:nth-child(14) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(8) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(8) > ul > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(8) > ul > li:nth-child(3) > ul > li:nth-child(14) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(8) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(8) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(8) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(14) > ul.nav-list { display: block; }</style><script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><title>Pre-Processing fMRI Data | Holmes Lab Documentation</title><meta name="generator" content="Jekyll v3.10.0" /><meta property="og:title" content="Pre-Processing fMRI Data" /><meta property="og:locale" content="en_US" /><meta name="description" content="Documentation for the Holmes Lab at Rutgers University, Department of Psychiatry" /><meta property="og:description" content="Documentation for the Holmes Lab at Rutgers University, Department of Psychiatry" /><link rel="canonical" href="http://localhost:4000/docs/resources/learning/preprocessing/" /><meta property="og:url" content="http://localhost:4000/docs/resources/learning/preprocessing/" /><meta property="og:site_name" content="Holmes Lab Documentation" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pre-Processing fMRI Data" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation for the Holmes Lab at Rutgers University, Department of Psychiatry","headline":"Pre-Processing fMRI Data","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo_circle.png"}},"url":"http://localhost:4000/docs/resources/learning/preprocessing/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"><div class="site-logo" role="img" aria-label="Holmes Lab Documentation"></div></a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Current Projects category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/current-projects/" class="nav-list-link">Current Projects</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in PCX category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/current-projects/PCX/" class="nav-list-link">PCX</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/current-projects/PCX/pcx-sop/" class="nav-list-link">Study Procedure</a><li class="nav-list-item"><a href="/docs/current-projects/PCX/study-overview/" class="nav-list-link">Study Overview</a><li class="nav-list-item"><a href="/docs/current-projects/PCX/IRBs/" class="nav-list-link">IRBs</a><li class="nav-list-item"><a href="/docs/current-projects/PCX/accessing-eris/" class="nav-list-link">Accessing Eris (MGB Server)</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Amarel Computing category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/amarel-computing/" class="nav-list-link">Amarel Computing</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/amarel-computing/modules-in-amarel/" class="nav-list-link">Modules in Amarel</a><li class="nav-list-item"><a href="/docs/amarel-computing/setting-ssh-key/" class="nav-list-link">SSH Keys</a><li class="nav-list-item"><a href="/docs/amarel-computing/slurm-jobs-tutorial/" class="nav-list-link">Slurm Jobs Tutorial</a><li class="nav-list-item"><a href="/docs/amarel-computing/update-python/" class="nav-list-link">Update to New Python in Amarel</a><li class="nav-list-item"><a href="/docs/amarel-computing/amarel-computing/" class="nav-list-link">Amarel Compute Cluster - General</a><li class="nav-list-item"><a href="/docs/amarel-computing/rutgers-vpn/" class="nav-list-link">Connecting to Rutgers VPN</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Lab Policies category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/lab-policies/" class="nav-list-link">Lab Policies</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/lab-policies/filesystem-amarel/" class="nav-list-link">Filesystem in Amarel</a><li class="nav-list-item"><a href="/docs/lab-policies/lab-overview/" class="nav-list-link">Lab Overview</a><li class="nav-list-item"><a href="/docs/lab-policies/software-we-use/" class="nav-list-link">Software We Use</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Lab Space at CAHBIR category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/lab-space/" class="nav-list-link">Lab Space at CAHBIR</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/lab-space/CAHBIR-mailing-list/" class="nav-list-link">CAHBIR E-Mailing List SOP</a><li class="nav-list-item"><a href="/docs/lab-space/lab-inventory/" class="nav-list-link">Lab Inventory</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MRI at CAHBIR category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/lab-space/MRI%20at%20CAHBIR/" class="nav-list-link">MRI at CAHBIR</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/lab-space/MRI%20at%20CAHBIR/CAHBIR%20MRI%20Suite%20eac375354411485fa30ddaa64d667fe9/" class="nav-list-link">CAHBIR MRI Suite</a><li class="nav-list-item"><a href="/docs/lab-space/MRI%20at%20CAHBIR/Flywheel%20Tutorial%201a4cf00eb9368016aca9cb6c273b301d/" class="nav-list-link">Flywheel Tutorial</a><li class="nav-list-item"><a href="/docs/lab-space/MRI%20at%20CAHBIR/Flywheel%20in%20Command%20Line%201cacf00eb93680789f7ae9551558eba0/" class="nav-list-link">Flywheel in Command Line</a><li class="nav-list-item"><a href="/docs/lab-space/MRI%20at%20CAHBIR/MRI%20Training%201%20at%20CAHBIR%20(SRB)%200eb6e57604dc464c8c252f5b725ad1c4/" class="nav-list-link">MRI Training 1</a><li class="nav-list-item"><a href="/docs/lab-space/MRI%20at%20CAHBIR/Scheduling%20MRI%20Scans%20at%20CAHBIR%20173cf00eb9368082b3c1ec7c9d39c66e/" class="nav-list-link">Scheduling MRI Scans at CAHBIR</a></ul><li class="nav-list-item"><a href="/docs/lab-space/parking/" class="nav-list-link">Parking Permits</a><li class="nav-list-item"><a href="/docs/lab-space/printer-supplies/" class="nav-list-link">Printer Supplies</a><li class="nav-list-item"><a href="/docs/lab-space/service-request/" class="nav-list-link">Service Request Tutorial</a><li class="nav-list-item"><a href="/docs/lab-space/software-purchasing/" class="nav-list-link">Software Purchasing</a><li class="nav-list-item"><a href="/docs/lab-space/work-requests/" class="nav-list-link">Work Requests at CAHBIR</a><li class="nav-list-item"><a href="/docs/lab-space/zoom-with-owl/" class="nav-list-link">Zoom meetings with OWL Setup</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Open Source Data category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/open-source-data/" class="nav-list-link">Open Source Data</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/open-source-data/open-source-data/" class="nav-list-link">Data Resource Sites</a><li class="nav-list-item"><a href="/docs/open-source-data/data-from-nda/" class="nav-list-link">Tutorial - Data from NDA</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Purchasing category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/purchasing/" class="nav-list-link">Purchasing</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/purchasing/check-request/" class="nav-list-link">Check Request Tutorial</a><li class="nav-list-item"><a href="/docs/purchasing/computer-purchasing/" class="nav-list-link">Computer Purchasing</a><li class="nav-list-item"><a href="/docs/purchasing/purchasing/" class="nav-list-link">Purchasing Tutorial</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Resources category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/resources/" class="nav-list-link">Resources</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Coding Resources category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/resources/coding/" class="nav-list-link">Coding Resources</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/resources/coding/resources/" class="nav-list-link">Coding Tutorials from Online</a><li class="nav-list-item"><a href="/docs/resources/coding/courses/" class="nav-list-link">Courses Online</a><li class="nav-list-item"><a href="/docs/resources/coding/freesurfer/" class="nav-list-link">FreeSurfer Overview</a><li class="nav-list-item"><a href="/docs/resources/coding/networkX/" class="nav-list-link">NetworkX and PyTorch Basics</a><li class="nav-list-item"><a href="/docs/resources/coding/packages/" class="nav-list-link">Packages for fMRI Analysis</a><li class="nav-list-item"><a href="/docs/resources/coding/shell-scripting/" class="nav-list-link">Shell Scripting Primer</a></ul><li class="nav-list-item"><a href="/docs/resources/grant-writing/" class="nav-list-link">Grant Writing Resources</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Learning Resources category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/resources/learning/" class="nav-list-link">Learning Resources</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/resources/learning/Learning%20Resources/" class="nav-list-link">Neuroimaging Resource Sites</a><li class="nav-list-item"><a href="/docs/resources/learning/network-neuroscience-primer/" class="nav-list-link">Network Neuroscience Primer</a><li class="nav-list-item"><a href="/docs/resources/learning/glossary/" class="nav-list-link">Glossary</a><li class="nav-list-item"><a href="/docs/resources/learning/phd-applications/" class="nav-list-link">PhD Applications</a><li class="nav-list-item"><a href="/docs/resources/learning/pipeline-dfc/" class="nav-list-link">Pipeline Outline for dFC Research</a><li class="nav-list-item"><a href="/docs/resources/learning/books-movies/" class="nav-list-link">Books & Movies - Neuroscience</a><li class="nav-list-item"><a href="/docs/resources/learning/brain-atlases/" class="nav-list-link">Brain Network Analysis (using Atlases)</a><li class="nav-list-item"><a href="/docs/resources/learning/cca/" class="nav-list-link">Canonical Correlation Analysis</a><li class="nav-list-item"><a href="/docs/resources/learning/dfc-analysis/" class="nav-list-link">Dynamic FC Patterns</a><li class="nav-list-item"><a href="/docs/resources/learning/dtw/" class="nav-list-link">Dynamic Time Warping (DTW)</a><li class="nav-list-item"><a href="/docs/resources/learning/courses-neuroimaging/" class="nav-list-link">External Courses / Workshops</a><li class="nav-list-item"><a href="/docs/resources/learning/file-types/" class="nav-list-link">File Types - Neuroimaging</a><li class="nav-list-item"><a href="/docs/resources/learning/glm/" class="nav-list-link">General Linear Model</a><li class="nav-list-item"><a href="/docs/resources/learning/preprocessing/" class="nav-list-link">Pre-Processing fMRI Data</a><li class="nav-list-item"><a href="/docs/resources/learning/fmri-to-network/" class="nav-list-link">fMRI → Network</a><li class="nav-list-item"><a href="/docs/resources/learning/fmriprep/" class="nav-list-link">fMRIPrep Overview</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Running Experiments category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/running-experiments/" class="nav-list-link">Running Experiments</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/running-experiments/irb-submission/" class="nav-list-link">IRBs</a><li class="nav-list-item"><a href="/docs/running-experiments/scales/" class="nav-list-link">Self-Report Scales</a><li class="nav-list-item"><a href="/docs/running-experiments/using-psychopy/" class="nav-list-link">Using PsychoPy</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Rutgers Admin category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/rutgers-admin/" class="nav-list-link">Rutgers Admin</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/rutgers-admin/citi/" class="nav-list-link">CITI Courses</a><li class="nav-list-item"><a href="/docs/rutgers-admin/helpful-links/" class="nav-list-link">Helpful Links</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Rutgers Admin category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/rutgers-admin/rutgers-contacts/" class="nav-list-link">Rutgers Admin</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/rutgers-admin/citi/" class="nav-list-link">CITI Courses</a><li class="nav-list-item"><a href="/docs/rutgers-admin/helpful-links/" class="nav-list-link">Helpful Links</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Travel & Reimbursements category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/travel-reimbursements/" class="nav-list-link">Travel & Reimbursements</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/travel-reimbursements/concur-reimbursement/" class="nav-list-link">Concur Travel Booking</a></ul><li class="nav-list-item"><a href="/docs/using-this-wiki/markdown/" class="nav-list-link">Using Markdown</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Using this Wiki category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/using-this-wiki/" class="nav-list-link">Using this Wiki</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/using-this-wiki/using-this-wiki/" class="nav-list-link">How to update this wiki</a><li class="nav-list-item"><a href="/docs/using-this-wiki/structure/" class="nav-list-link">Structure of this Wiki</a></ul></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://holmeslab.rutgers.edu/" class="nav-list-link external" > Holmes Lab Website <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Holmes Lab Documentation" aria-label="Search Holmes Lab Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/HolmesLab/holmeslab" class="site-button" target="_blank" rel="noopener noreferrer" > This Repository on Github </a></ul></nav></div><div class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/resources/">Resources</a><li class="breadcrumb-nav-list-item"><a href="/docs/resources/learning/">Learning Resources</a><li class="breadcrumb-nav-list-item"><span>Pre-Processing fMRI Data</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="pre-processing-fmri-data"> <a href="#pre-processing-fmri-data" class="anchor-heading" aria-labelledby="pre-processing-fmri-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pre-Processing fMRI Data</h1><p>Date: January 22, 2024 10:11 AM</p><p>Sources: Glasser/HCP Preprocessing**</p><p>[<strong>A multi-modal parcellation of human cerebral cortex](https://www.nature.com/articles/nature18933) (2016)</strong></p><p>[<strong>The Minimal Preprocessing Pipelines for the Human Connectome Project](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3720813/) (2014)</strong></p><p>**other common pre-processing pipeline is “fMRI Prep”</p><h1 id="processing-pipeline-hcp-fmri-data"> <a href="#processing-pipeline-hcp-fmri-data" class="anchor-heading" aria-labelledby="processing-pipeline-hcp-fmri-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Processing Pipeline: HCP fMRI Data</h1><h3 id="function-of-the-preprocessing-pipeline"> <a href="#function-of-the-preprocessing-pipeline" class="anchor-heading" aria-labelledby="function-of-the-preprocessing-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Function of the Preprocessing Pipeline</h3><p>1) to remove spatial artifacts and distortions</p><p>2) to generate cortical surfaces, segmentations, and myelin maps</p><p>3) to make the data easily viewable in the Connectome Workbench visualization software (Marcus et al, THIS ISSUE)</p><p>4) to generate precise within-subject cross-modal registrations</p><p>5) to handle surface and volume cross-subject registrations to standard volume and surface spaces</p><p>6) to make the data available in the CIFTI format in a standard “grayordinates” space (see below)</p><h3 id="benefits-of-the-preprocessing-pipeline"> <a href="#benefits-of-the-preprocessing-pipeline" class="anchor-heading" aria-labelledby="benefits-of-the-preprocessing-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits of the Preprocessing Pipeline</h3><ul><li>Combines information from architecture, function, connectivity and topography to parcellate<ul><li>complementary and confirmatory information</ul><li>Allows greater computational efficiency from 100,000 voxels to 50-200 ROIs, to enable large-scale research projects with fMRI data<li>combines literature-documented areas/ROIs and automated algorithmic approaches<li>aligned cortical data using myelin content and rs networks, instead of cortical folding alignment, which are ‘more closely tied to cortical areas’</ul><p>HCP Style</p><p>Goals:</p><ul><li>making it functional for connectivity processes (aka making it a 2D mesh to represent the 3D brain)<li>generate a repository of large high-quality multi-modal data<li>intersubject alignmnet that doesn’t require smoothing</ul><h2 id="methods"> <a href="#methods" class="anchor-heading" aria-labelledby="methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>METHODS</strong></h2><h3 id="hardware-specs"> <a href="#hardware-specs" class="anchor-heading" aria-labelledby="hardware-specs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hardware specs</h3><p>(in paper)</p><h3 id="data"> <a href="#data" class="anchor-heading" aria-labelledby="data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data:</h3><p>Three surface spaces in HCP data:</p><ol><li>the native surface mesh for each individual (~136k vertices/voxels, most accurate for volume to surface mapping)<li>the high resolution Conte69 registered standard mesh (~164k vertices, appropriate for cross-subject analysis of high resolution data like myelin maps)<li>low resolution Conte69 registered standard mesh (~32k vertices, appropriate for cross-subject analysis of low resolution data like fMRI or diffusion).</ol><p><img src="/docs/resources/learning/Pre-Processing%20fMRI%20Data%20cd24a0ec0f6140728bd5cb290934031d/Untitled.png" alt="Untitled" /></p><ul><li>The 91,282 standard grayordinates (CIFTI) space is made up of a standard subcortical segmentation in 2mm MNI space (from the Conte69 subjects) and the 32k Conte69 mesh of both hemispheres/</ul><h3 id="software"> <a href="#software" class="anchor-heading" aria-labelledby="software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Software:</h3><p><img src="/docs/resources/learning/Pre-Processing%20fMRI%20Data%20cd24a0ec0f6140728bd5cb290934031d/Untitled%201.png" alt="Untitled" /></p><p><strong>Structural Pipeline</strong></p><h3 id="prefreesurfer-pipeline"> <a href="#prefreesurfer-pipeline" class="anchor-heading" aria-labelledby="prefreesurfer-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PreFreeSurfer Pipeline</h3><p><strong><em>produce an undistorted “native” structural volume space for each subject (used for tractography, most accurate to physical brain)</em></strong></p><ol><li>correct for gradient nonlinearity distortion using a customized version of the <code class="language-plaintext highlighter-rouge">gradient_nonlin_unwarp</code> package available in FreeSurfer<li>calculates an FSL-format warpfield that represents the spatial distortion of the image by using a proprietary Siemens gradient coefficient file (available on the scanner used to acquire the images) and the mm coordinate space of the image (including the rotation between image matrix space and scanner axes – that is, the oblique portion of the sform, where the sform is the matrix that relates the voxel coordinates to the mm coordinate space of the scanner, as defined by the NIFTI standard).<li>aligned with a 6 degrees of freedom (DOF) rigid body transformation using FSL’s <code class="language-plaintext highlighter-rouge">FLIRT</code><li>For greater robustness, the images are internally cropped to a smaller FOV to remove the neck (150mm in z in humans,) using FSL’s automated <code class="language-plaintext highlighter-rouge">robustfov</code> tool, and aligned with a 12 DOF (affine) <code class="language-plaintext highlighter-rouge">FLIRT</code> registration to the MNI space templates</ol><p><strong><em>align the T1w and T2w images</em></strong></p><ol><li>“acpc alignment step”:<ol><li>align to the MNI space template (with 0.7mm resolution for the HCP data) using a rigid 6 DOF transform (aligns the AC, the AC-PC line and the inter-hemispheric plane)</ol><li><code class="language-plaintext highlighter-rouge">robustfov</code> used to make sure reg is robust and transform is applied with spline interpolation<li>robust initial brain extraction is performed using an initial linear (<code class="language-plaintext highlighter-rouge">FLIRT</code>) and non-linear (<code class="language-plaintext highlighter-rouge">FNIRT</code>) registration of the image to the MNI template<li>This warp is then inverted and the template brain mask is brought back into the acpc-alignment space<li>removing readout distortion:(corrected by the same means as EPI distortion)”<ol><li>For fieldmap preprocessing, a standard gradient echo fieldmap, having two magnitude images (at two different TEs) and a phase difference image, is converted into fieldmap (in units of radians per second) using the <code class="language-plaintext highlighter-rouge">fsl_prepare_fieldmap</code> script.<li>Then the mean magnitude and fieldmap images are corrected for gradient nonlinearity distortion (just as for the T1w and T2w images).<li>The fieldmap magnitude image is warped according to the readout distortion and registered, separately, to the T1w and T2w images using <code class="language-plaintext highlighter-rouge">6 DOF FLIRT</code>.<li>The fieldmap is then transformed according to these registrations and used to unwarp the T1w and T2w images, removing the differential readout distortion present in them.</ol><p><em>→ subject’s undistorted native volume space</em></p></ol><p><strong><em>perform a B1 (bias field) correction</em></strong></p><p>(bias field <em>F</em> is estimated from the square root of the product of the T1w and T2w images after thresholding out non-brain tissues)</p><ol><li>dilating the thresholded bias-field estimate (<em>F</em>) to fill the FOV<li>bias field smoothed with a sigma of 5mm</ol><p><em><strong>register the subject’s native structural volume space to MNI space</strong> (</em>useful for comparison across subjects)</p><ol><li>registered to MNI space with a FLIRT 12 DOF affine and then a FNIRT nonlinear registration</ol><p>→ producing the final nonlinear volume transformation from the subject’s native volume space to MNI space</p><p>→ Output</p><p>→ T1w folder: native volume space images</p><p>→ MNINonLinear folder: MNI space images</p><p><img src="/docs/resources/learning/Pre-Processing%20fMRI%20Data%20cd24a0ec0f6140728bd5cb290934031d/Untitled%202.png" alt="Untitled" /></p><h3 id="freesurfer-pipeline"> <a href="#freesurfer-pipeline" class="anchor-heading" aria-labelledby="freesurfer-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>FreeSurfer</em> Pipeline</h3><p>Run FreeSurfer <code class="language-plaintext highlighter-rouge">recon-all</code></p><p><strong>**limitation of recon-all: cannot handle images of higher than 1mm isotropic resolution or structural scans of greater than 256 × 256 × 256 voxels → downsample to 1mm isotropic (RAS) space aka “FreeSurfer space”</strong>**</p><p>Output:</p><ol><li>to segment the volume into predefined structures (including the subcortical parcels used in CIFTI)<li>reconstruct white and pial cortical surfaces<li>perform FreeSurfer’s standard folding-based surface registration to their surface atlas (fsaverage)</ol><h3 id="postfreesurfer-pipeline"> <a href="#postfreesurfer-pipeline" class="anchor-heading" aria-labelledby="postfreesurfer-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <em>PostFreeSurfer</em> Pipeline</h3><ol><li><p>take the outputs of FreeSurfer that are in FreeSurfer proprietary formats and convert them to standard NIFTI and GIFTI formats</p><p>NIFTI</p><ol><li>the three full subcortical volume parcellations are converted to NIFTI label files</ol><p>GIFTI</p><ol><li>The white, pial, spherical, and registered spherical surfaces are all converted to GIFTI surface files<li>thickness, curvature, and sulc are all converted to GIFTI shape files<li>The three FreeSurfer cortical parcellations are converted to GIFTI label files<li>One of these volume parcellations, the wmparc, is binarized, dilated three times and eroded twice to produce an accurate subject-specific brain mask of grey and white matter, which serves as the final brain mask that is used in any subsequent functional or diffusion processing.</ol><li><p>Return data to the native volume space from the FreeSurfer 1mm RAS space</p></ol><p>→ produces all of the NIFTI volume and GIFTI surface files necessary for viewing the data in Connectome Workbench,</p><ol><li>applying the surface registration (to the Conte69 surface template (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3720813/#R61">Van Essen et al., 2012b</a>))<li>downsampling registered surfaces for connectivity analysis<li>creating the final brain mask<li>creating myelin maps.</ol><p><strong>Functional Pipelines</strong></p><h3 id="fmrivolume-pipeline"> <a href="#fmrivolume-pipeline" class="anchor-heading" aria-labelledby="fmrivolume-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> fMRIVolume Pipeline</h3><p><em>Preparation for fMRIVolume Pipeline<strong>:</strong> Completion of HCP structural pipelines (PreFreeSurfer, FreeSurfer, and PostFreeSurfer). Correction of gradient-nonlinearity-induced distortion.</em></p><ul><li><strong>Motion Correction:</strong><ul><li>Realignment of timeseries to correct for subject motion with 6 DOF <code class="language-plaintext highlighter-rouge">FLIRT</code> registration.</ul><p>→ Output of motion parameters in a twelve column text file.</p><li><strong>Distortion Correction:</strong><ul><li>Correction of distortion in phase encoding direction using <code class="language-plaintext highlighter-rouge">fieldmap</code> or spin echo EPI scans.<li>Alignment of distorted spin echo EPI images to distorted gradient echo EPI single-band reference image.<li>Concatenation of registration with topup-derived distortion field for undistorting fMRI images.</ul><li><strong>Registration to T1w Image:</strong><ul><li>Registration of single-band reference image to T1w image using <code class="language-plaintext highlighter-rouge">FLIRT</code> with <code class="language-plaintext highlighter-rouge">BBR cost</code> function and <code class="language-plaintext highlighter-rouge">BBRegister</code> for fine tuning.</ul><li><strong>Final Steps:</strong><ul><li>Concatenation of all transforms for each registration and distortion correction into a single nonlinear transformation.<li>Transformation of each fMRI timepoint directly to MNI space with single spline interpolation.<li>Removal of bias field calculated from structural images.<li>Masking of data by final brain mask from PostFreeSurfer pipeline and normalization to a 4D whole brain mean of 10000.</ul></ul><p>→ <strong>Outputs:</strong></p><ul><li>NIFTI volume timeseries in MNINonLinear/Results/fMRIName in 2mm MNI space.<li>Single-band reference image in 2mm MNI space.<li>Jacobian file representing intensity modulations of distortion correction.<li>Original and demeaned/de-trended motion parameters for conventional volume-based fMRI analyses.</ul><h3 id="fmrisurface-pipeline"> <a href="#fmrisurface-pipeline" class="anchor-heading" aria-labelledby="fmrisurface-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> fMRISurface Pipeline</h3><ul><li><strong>Partial Volume Weighted Ribbon-Constrained Volume to Surface Mapping:</strong><ul><li>Use of white and pial surfaces to define grey matter ribbon.<li>Calculation of weighted average intensity for each surface vertex.<li>Handling of voxels partially inside grey matter ribbon.</ul><li><strong>Exclusion of Voxels with High Coefficient of Variation:</strong><ul><li>Exclusion of voxels with locally high coefficient of variation.<li>Masking of brain voxels not excluded by coefficient of variation threshold.</ul><li><strong>Surface Timeseries Resampling:</strong><ul><li>Resampling of surface timeseries from high-resolution native mesh to registered downsampled 32k_fs_LR mesh.<li>Masking of medial wall vertices.<li>Smoothing of fMRI timeseries on surface (2mm FWHM).</ul><li><strong>Geodesic Gaussian Surface Smoothing Algorithm:</strong><ul><li>Calculation of geodesic distance for each vertex.<li>Correction for differences in triangle areas associated with each vertex.<li>Multiplication of weights by vertex area within each smoothing kernel.</ul><li><strong>Volume Voxels Resampling:</strong><ul><li>Resampling of volume voxels onto standard mesh for corresponding voxels across subjects.<li>Parcel-constrained atlas smoothing/resampling process.<li>Combination of surface and subcortical volume timeseries into a single data matrix.</ul><li><strong>Output:</strong><ul><li>CIFTI dense timeseries representing grey matter timeseries data.<li>Regeneration of hemisphere surface and parcel-constrained subcortical volume timecourses from CIFTI dense timeseries using Connectome Workbench’s commandline utilities.</ul></ul><p><strong>Diffusion Analysis</strong></p><ul><li><strong>Intensity Normalization and EPI Distortion Estimation:</strong><ul><li>Normalization of mean b0 image across six diffusion series.<li>Use of phase encoding direction reversed b0 pairs to estimate EPI distortion.<li>Estimation of distortion field using “topup” tool in FSL5.</ul><li><strong>Distortion Correction and Motion Estimation:</strong><ul><li>Correction of distortions and estimation of eddy-current induced field inhomogeneities and head motion using Gaussian Process predictor.<li>Correction of distortions in single resampling step using “eddy” tool in FSL5.</ul><li><strong>Gradient Nonlinearity Correction:</strong><ul><li>Calculation of gradient nonlinearity correction warpfield for diffusion data.<li>Distortion correction of mean b0 image.<li>Calculation of effects of gradient nonlinearity on diffusion encoding magnitudes and directions.</ul><li><strong>Order of Corrections:</strong><ul><li>Explanation of the order of distortion corrections within the diffusion pipeline.</ul><li><strong>Registration to Structural Space:</strong><ul><li>Registration of mean b0 image to T1w structural image using boundary-based registration.<li>Transformation of diffusion data to native structural volume space.<li>Masking of data with final brain mask from PostFreeSurfer.</ul><li><strong>Transformation of Gradient Vectors and Field Tensor:</strong><ul><li>Rotation of gradient vectors according to rotational component of b0 to T1w registration.<li>Transformation of gradient field tensor using b0 to T1w registration.</ul><li><strong>Visualization and Further Analysis:</strong><ul><li>Visualization of diffusion data with structural space surfaces and images in Connectome Workbench.<li>Potential use of structural space diffusion data for fiber orientation estimation with FSL’s multi-shell spherical deconvolution toolbox.</ul></ul><h3 id="terms-or-themes-keywords-and-definitions"> <a href="#terms-or-themes-keywords-and-definitions" class="anchor-heading" aria-labelledby="terms-or-themes-keywords-and-definitions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terms or Themes (keywords and definitions)</h3><ul><li><p>Connectivity Informatics Technology Initiative (CIFTI) File Format</p><p>file format to support <a href="http://www.nitrc.org/plugins/mwiki/index.php/cifti:ConnectivityMatrixFileFormats">connectome-specific data representations</a></p><ul><li>data modeled on surface &amp; grey matter data in volumetric parcels<ul><li>cortical surface vertices<li>subcortical voxels</ul><li><ul><li>spatial dimension = “grayordinates”<ul><li>more precise than volumetrically aligned data<li>same across subjects<ul><li>by using registration methods suited to aligning each domain</ul></ul></ul><li>created to be more compect representation of high spatial and temporal resolution MRI data<li>combines left and right hemispheres, as well as cortical and subcortical parcels, into a single file for analysis<li>datasets from different subjects have the same spatial dimensions</ul><p>includes: many 2D matrices</p><ul><li>CIFTI Header: describing the structure/part of the brain that each row and column of the matrix correspond to<li>grayordinates x time series (dense timeseries)<li>grayordinates x grayordinates (dense Connectome)<li>grayordinates x parcellation labels (dense Label file)</ul><li><p>Grayordinates</p><p>Modelling of grey matter data which saves space because it models surface and volume together (so there are less parcels for fully connected matrices)</p><li><p>White matter</p><p>neural glia (non neuron)</p><p>structural</p><li><p>gray matter</p><p>where functinoal connectivity takes place</p><li><p>cytoarchitecture</p><p>cellular properties of that portion of cortex tends to be the same —defining a region based on a history of doing anatomy studies</p><li><p>Dense Connectome</p><p>Connectivity matrix describing connectivity between each of the available voxels to each other, fully connected matrix</p></ul><h3 id="linking-to-me"> <a href="#linking-to-me" class="anchor-heading" aria-labelledby="linking-to-me"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Linking to Me</h3><p><em>For Research (how is this research relevant to your work?)</em></p></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2025 Avram Holmes. Distributed by an <a href="https://github.com/just-the-docs/just-the-docs/tree/main/LICENSE.txt">MIT license.</a> <a href="https://www.netlify.com/">This site is powered by Netlify.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/HolmesLab/holmeslab/tree/main/docs/resources/learning/preprocessing.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
